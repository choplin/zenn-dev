---
title: "Claude Code実践ガイド - 1. 問題と対処法編"
emoji: "🤖"
type: "tech"
topics: ["ai", "claudecode", "開発効率", "エンジニアリング"]
published: true
---

Claude Codeを使い込む中で実際に遭遇した3つの問題とそれぞれの対処法を共有します。

この記事は、Claude Codeをすでに使い始めていて、より効率的に活用したいと考えている方を対象としています。基本的な操作方法は理解していることを前提に、実践的な課題と解決策に焦点を当てています。

## 前提

記事執筆時点での私のClaude Code使用状況はこんな感じです。

- [ccusage](https://github.com/ryoppippi/ccusage)で計測：API換算で約$7,000相当、約30億トークン ※実際にはClaude Maxプランで定額
- 約1ヶ月（2025年5月〜6月）
- 業務とプライベートの両方（Java、Go、ドキュメント生成）
- レビュー時の微修正を除いてClaude Codeになるべく全部書かせる

## Claude Codeの3つの問題

### 1. メモリの指示は守られない

Claude Codeに限らずAIエージェントの活用において、メモリ機能の使用が挙げられることが多いです。ユーザー単位、あるいはプロジェクト単位での共通した知識を特定のパスのファイルに記載しておくことで、プロンプト立ち上げ時に自動的にその内容を理解した状態で開始される、というものです。Claude Codeだと[これ](https://docs.anthropic.com/en/docs/claude-code/memory)ですね。

メモリ機能は非常に便利かつ重要で、AIとユーザ側とで認識の共通基盤として活用することができます。私も色々な指示を入れており、日々内容を改善しています。

一方で、メモリの指示は必ずしも守られません。メモリに書いてあることを守ろうとするのは確かですが、必ずしも守ってくれるわけではない、というのが現状です。指示の内容が規範的なあいまいなものであるほど、指示を守らなくなるように感じますが、具体的な指示でも常に守られるとは限りません。例えば、私は「**Always respond in Japanese** regardless of the language used by the user」という指示を `~/.claude/config/CLAUDE.md` の先頭の方に書いていますが、プロンプト一発目の返答を英語で返してくることが頻繁にあります。人間であっても「〇〇の時は〇〇しよう」なのを人から言われて実践するのは簡単ではないですよね。

ある規則にもとづいたフックのような処理や、一連のワークフローをメモリに記述して利用しようとする記事などを見かけます。この手のものは大抵うまくいきません。フックやワークフローのような処理に限らず、「〇〇の時は〇〇する」あるいは「いつも〇〇しよう」みたいな指示は、守られないことも多く、プログラミングのif文の感覚で使うのは危険です。

### 2. 未完成のコードで完了報告する

よく知られた問題ではありますが、Claude Codeはしばしば保身のため？の嘘をつきます。私が経験したなかでは以下のようなことがありました。

- 実装完了しました！ → 関数の中身がTODOコメントのまま
- 実装にもとづいてドキュメントを書きました！→ 推測や意見を混ぜ込んで事実でない内容が書かれている
- テストが通りました！ → テストにスキップ処理を入れてテストが通ったことにしてる

また、Xで見かけたこの事例は印象的でした。Claude Codeかはわからないですが、TypeScriptとwasmのベンチマークの作成をAIに頼んだら、中身は平均2倍の差がでるプレースホルダのままUIの作成だけ進めており、依頼者はそれに気づかずに2倍の差があったという内容で公開したということがあったようです。現在は記事毎削除されたようですが、今後この手の事例は増えていくでしょう。
https://x.com/tanakh/status/1936076778344530321

また、AIが真摯に実装を行った場合でも、100点のコードは出てきません。実装力としてはジュニアレベルくらいと言われることが多いようです。個人的には、設計を丁寧に行い実装の方向性さえ共有できていれば、ジュニアレベルよりはしっかり実装を進めてくれるとは感じます。とはいえ、一発OKのクオリティであることは少なく、レビューでの修正はかかせません。

### 3. 非効率な方法を選んでしまう

Claude Codeは組み込みのToolやユーザが設定したMCPを用いて処理を進めます。そのためユーザーが従来IDEやCLIツールを使って効率的に行っていた処理でも、大幅に非効率なやり方で進めようとすることがあります。

例えば、現状ではClaude CodeではLSP（Language Server Protocol）を使ってくれません。そのため、リファクタリングなどで非効率な実装をすることがあります。例えば、LSPを使えば一瞬で完了するリネームのような単純なリファクタリングでも、mvとgrepで進めようとします。従来の開発環境でのメンタルモデルのままClaude Codeに依頼をすると、非効率な選択をしてしまう可能性があるため、Claude Codeに合わせたメンタルモデルにもとづいて依頼を行っていく必要があります。

この点については、開発環境のエコシステムは徐々にClaude Codeに取り込まれていく流れにあるので、将来的には問題ではなくなるとは思います。

## 実践的な対処法

### 1. 指示の出し方を体系化する - スラッシュコマンドとスクリプトの活用

Claude Codeに一定の処理をさせたい場合には、メモリ機能のみではなく、[スラッシュコマンド](https://docs.anthropic.com/en/docs/claude-code/slash-commands#custom-slash-commands)を活用することができます。スラッシュコマンドは以下のような決められたパスに`.md`ファイルを置いておくことにより、そのファイルの内容を `/my-command` というコマンドで一発でプロンプトとして渡すことができる、というものです。Claude Code側で補完もしてくれるため、少ないタイプ数で呼び出すことができます。

```console
vim ~/.claude/slash-commands/my-command.md
```

起動時に一度読み込むメモリに対して、スラッシュコマンドはその指示を実行するタイミングでユーザー側が明示的に呼び出すことになります。ユーザー側の手間は増えますが、指示の意図とコンテクストが明確になるためか、複数ステップからなる複雑な指示でも、正確に遂行してくれることが多いです。スラッシュコマンドは、メモリの指示を補完するものとして非常に有用です。

Claude Codeをしばらく使い込んでいると、自分の作業の中で頻発するフローやよく使う指示が浮かび上がってくるので、何度か遭遇したらスラッシュコマンド化していくことで、Claude Codeとの協働でのワークフローがどんどん洗練されていきます。

私が実際に使っているスラッシュコマンドの例：
- `/remind` - グローバルメモリの指示を再読み込みして遵守を促す
- `/suspend` - 現在の作業コンテキストを保存して中断
- `/resume` - 中断した作業を再開する際のコンテキスト復元
- `/discuss` - 実装なしでアイデアを深く議論する対話モード
- `/critical-review` - 第三者視点での批判的レビュー
- `/fact-check` - 技術文書の事実確認
- `/quick-chat` - 率直なフィードバックに特化した会話モード
- `/new-slash-command` - スラッシュコマンドの新規作成

もしくは、処理として完全に定型的なものであれば、その処理をスクリプト化しておき、Claude Codeからはスクリプトを呼ぶだけにしておく方法も便利です。もちろんスラッシュコマンドとも併用できます。これは従来の開発環境でもよく行われている方法で、CLIツールやスクリプトを使って定型的な処理を自動化するのと全く同じです。スクリプト化することで、AIに任せることができる処理を増やすことができ、AIとの協働をより効率的に進めることができます。

必要なフローや共有したいコンテクストは、個人やチームによって異なるため、実際にClaude Codeを使い込んで見出していくことが重要です。 Claude Codeを使い込む → よく使うフローやコンテクストが見えてくる → メモリ、スラッシュコマンド、スクリプト化 → Claude Codeとの協働フローが洗練される、というサイクルを回していくことが重要です。このサイクルを回すことで、自分なりのClaude Codeとの協働フローが確立され、効率的な開発が可能になります。

### 2. 品質チェックの仕組みを作る - 文書ファーストとAIレビュー

Claude Codeは人間を遥かに超える速度でコードを生成できますが、品質については一切の保証をしません。そのため、成果物の品質の保証は人間が行う必要があり、そのためのレビューが非常に重要です。Claude Codeとの協働が進んでくると、人間のレビューがボトルネックになってきます。効率的なレビュー体制を構築することが、Claude Codeとの協働において非常に重要です。

#### 2.1 文書ファーストの開発プロセスの構築

まず何も準備せずにレビューを行う状況は避けるべきです。Claude Codeは高速に文書を生成可能であるため、従来よりもはるかに文書化を進めることができます。Claude Codeに実装を依頼する前に、実装の方向性や要件を明確にし文書化しておくことが重要です。文書化自体もClaude Codeとともに進めることで、従来よりも遥かに短時間で行うことが可能です。実装が開始してからも適宜文書化するように依頼します。これにより、レビュー時に必要な情報を事前に整備しておくことができ、レビューの効率と正確性を大幅に向上させることができます。

また、文書にもとづいた開発を進めることにより、Claude Codeが方向を見失っているような場合でも、文書を参照させることで、正しい方向に修正することが容易になります。文書ファーストの開発プロセスを構築することで、AIとの協働がよりスムーズになり、品質の高い成果物を得ることができます。

#### 2.2 AIによる補助レビューの活用

最終的な保証のためのレビューは人間が行いますが、内容の正確性のチェックや、実装の方向性の確認などについては、AIによる補助レビューを活用することができます。チェックしたいポイントを明確にし、AIにレビューを依頼することで、特定の観点についてのレビューをAIに負担させることができます。よくあるレビュー依頼は上記の通りスラッシュコマンド化しておくと便利です。

また、私は「ホワイトボックスレビュー」と「ブラックボックスレビュー」の2つのレビュー手法を使い分けています。やっていることは単純で、実装を行ったプロンプトのままレビューを行うか、新たなプロンプトを立ち上げて実装のコンテキストを渡さずにレビューを行うかの違いです。上記で文書を適切に整備しておくことで、新たにプロンプトを立ち上げて、文書を渡しながらレビューを依頼することにより、実装のコンテキストを切り離したブラックボックスレビューを行うことができます。実装時の思い込みから離れて問題を発見しやすくなるため効果的です。嘘をついている箇所も見抜いてくれることが多いです。例えば、ブランチでの作業内容をレビューする場合は、以下のようなスラッシュコマンドを用意しておくと便利です。

```markdown
# Black box Review

Review the changes in this branch referring to the document: $ARGUMENTS
```

### 3. 開発環境を最適化する - AIへの作業委託とツール整備

Claude Codeを使い始めると、思ったよりも多くの作業をAIに任せられることに気づくでしょう。楽しくなってあれもこれもやらせたくなりますが、実際にはAIに向いている作業とそうでない作業があります。それらを適切に分担することが、Claude Codeとの協働をスムーズに進めるために重要です。

とはいっても、人間があれこれやりすぎると、Claude Codeとの協働にむけたプロセス改善の試行錯誤が進まなくなります。Claude Codeに全て任せることを基本として、Claude Codeが上手く進められない部分を見出したら、そこを人間が補完するというスタンスがいいのではないかと思います。事前に内容が決まらないようなタスクは、Claude Codeに依頼することによって適当なToDoに分解して進めてくれるため、Claude Codeに積極的に依頼していった方が良く、一方でAIが非効率にしか進められない作業はCLIツールやスクリプト化などでパッケージング可能なことが多いです。積極的にパッケージングして、AIに委託可能な作業を増やしていくことも重要です。そのようにして、AIの分担を増やしていく、というスタンスが、Claude Codeとの協働をより効果的に進めるためのポイントであると考えています。

## まとめ

Claude Codeを使い込んで見えてきた3つの問題には、それぞれ実践的な対処法があります：

1. **指示は守られない** → スラッシュコマンドやスクリプトで確実性を高める
2. **成果物は信頼できない** → 文書ファーストとAIレビューで品質を保つ
3. **非効率な処理をする** → ツールの整備とAIへの作業委託を最大化する

これらの対処法は現時点でのベストプラクティスですが、Claude Code自体も急速に進化しているため、常に新しい方法を試していく姿勢が重要です。
